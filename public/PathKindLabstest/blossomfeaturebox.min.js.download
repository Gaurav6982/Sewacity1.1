var blossomfeaturebox=function(a){var t={fxeffect:"swing",displayfreq:"session",displaytype:{duration:"always",cookiename:"featurebox"}};function s(o){var e=new RegExp(o+"=[^;]+","i");return document.cookie.match(e)?document.cookie.match(e)[0].split("=")[1]:null}function n(o,e,i){var t,s="",n=new Date;void 0!==i&&(t=parseInt(i)*(/hr/i.test(i)?60:/day/i.test(i)?1440:1),n.setMinutes(n.getMinutes()+t),s="; expires="+n.toUTCString()),document.cookie=o+"="+e+"; path=/"+s}var r={featureboxloaded:!1,$blossomui:null,$blossominner:null,$errordiv:null,$blossomoptinarea:null,setting:null,buildblossomui:function(){this.$blossomui=a('<div id="call-bck" class="blossomfeaturebox"><div class="blossominner"><div class="optincontent2wrapper"></div><div class="closex" title="Close">Close</div><div class="errordiv"><span>:-(</span></div></div></div>').appendTo(document.body),this.$blossominner=this.$blossomui.find("div.blossominner"),this.$errordiv=this.$blossomui.find("div.errordiv"),this.$blossomoptinarea=this.$blossomui.find("div.optincontent2wrapper");this.$blossomui.find("div.close");a(document).on("keyup",function(o){"block"==r.$blossomui.css("display")&&27==o.keyCode&&r.hidefeaturebox()}),this.$blossomui.on("click",function(){r.hidefeaturebox()}),this.$blossomoptinarea.on("click",function(o){o.stopPropagation()})},showfeaturebox:function(o){o?this.featureboxloaded?this.showfeaturebox():this.populatebox(1):(a(document.documentElement).addClass("hidescrollbar"),setTimeout(function(){r.$blossomui.addClass("openbox")},5))},hidefeaturebox:function(){a(document.documentElement).removeClass("hidescrollbar"),this.$blossomui.removeClass("openbox")},setupdisplay:function(o){var e;this.showfeaturebox(),o||"always"==this.setting.displayfreq.duration||(e="session"==this.setting.displayfreq.duration?void 0:this.setting.displayfreq.duration,n(this.setting.displayfreq.cookiename,"yes",e),n(this.setting.displayfreq.cookiename+"_freq",this.setting.displayfreq.duration,this.setting.displayfreq.duration))},populatebox:function(o){var e,i=a.Deferred(),t=this.setting.optinfile;"#"==t.charAt(0)?0==a(t).length?i.reject():i.resolve():a.ajax({url:t,dataType:"html",error:function(o){i.reject(o)},success:function(o){i.resolve(o)}}),i.always(function(){r.$blossominner.addClass(r.setting.fxeffect)}),i.then(function(o){var n;r.$errordiv.hide(),o?r.$blossomoptinarea.html(o):a(t).show().appendTo(r.$blossomoptinarea),10<a(document).height()-window.innerHeight&&-1!=r.setting.displaytype.indexOf("%")?(clearTimeout(e),n=parseInt(r.setting.displaytype),a(window).on("scroll.showoptin",function(){clearTimeout(e),e=setTimeout(function(){var o=a(document).height(),e=a(window).scrollTop(),i=o-window.innerHeight,t=o-(e+window.innerHeight),s=100-Math.floor(t/i*100);n<=s&&(a(window).off("scroll.showoptin"),r.setupdisplay())},50)}),a(window).trigger("scroll.showoptin")):-1!=r.setting.displaytype.indexOf("s")?setTimeout(function(){r.setupdisplay()},1e3*parseInt(r.setting.displaytype)):r.setupdisplay(),r.featureboxloaded=!0}),i.fail(function(o){r.$blossomoptinarea.css("display","none"),r.$errordiv.attr("title","Error loading content: "+t).show(),r.showfeaturebox()})},init:function(o){var e=a.extend({},t,o),i=!0;this.setting=e,0==a("div.blossomfeaturebox").length&&r.buildblossomui(),"always"!=e.displayfreq.duration&&s(e.displayfreq.cookiename)&&(i=!1,s(e.displayfreq.cookiename+"_freq")!=e.displayfreq.duration&&(n(this.setting.displayfreq.cookiename,"",-1),i=!0)),i&&this.populatebox()}};return r}(jQuery);